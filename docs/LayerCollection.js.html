

<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
      LayerCollection.js - Documentation
  </title>

  <link href="https://www.braintreepayments.com/images/favicon-ccda0b14.png" rel="icon" type="image/png">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

  <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
  <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
  

  

  <!-- start Mixpanel -->
  <script type="text/javascript">(function(e,a){if(!a.__SV){var b=window;try{var c,l,i,j=b.location,g=j.hash;c=function(a,b){return(l=a.match(RegExp(b+"=([^&]*)")))?l[1]:null};g&&c(g,"state")&&(i=JSON.parse(decodeURIComponent(c(g,"state"))),"mpeditor"===i.action&&(b.sessionStorage.setItem("_mpcehash",g),history.replaceState(i.desiredHash||"",e.title,j.pathname+j.search)))}catch(m){}var k,h;window.mixpanel=a;a._i=[];a.init=function(b,c,f){function e(b,a){var c=a.split(".");2==c.length&&(b=b[c[0]],a=c[1]);b[a]=function(){b.push([a].concat(Array.prototype.slice.call(arguments,
  0)))}}var d=a;"undefined"!==typeof f?d=a[f]=[]:f="mixpanel";d.people=d.people||[];d.toString=function(b){var a="mixpanel";"mixpanel"!==f&&(a+="."+f);b||(a+=" (stub)");return a};d.people.toString=function(){return d.toString(1)+".people (stub)"};k="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config reset people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
  for(h=0;h<k.length;h++)e(d,k[h]);a._i.push([b,c,f])};a.__SV=1.2;b=e.createElement("script");b.type="text/javascript";b.async=!0;b.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";c=e.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}})(document,window.mixpanel||[]);
  mixpanel.init("1919205b2da72e4da3b9b6639b444d59");</script>
  <!-- end Mixpanel -->
</head>

<body>
  <svg style="display: none;">
    <defs>
      <symbol id="linkIcon" fill="#706d77" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
          <path d="M0 0h24v24H0z" fill="none"/>
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
      </symbol>
    </defs>
  </svg>

  <input type="checkbox" id="nav-trigger" class="nav-trigger" />
  <label for="nav-trigger" class="navicon-button x">
    <div class="navicon"></div>
  </label>

  <label for="nav-trigger" class="overlay"></label>

  <div class="top-nav-wrapper">
    <ul>
      <li >
        <a href="index.html">
          
            <svg fill="#6D6D6D" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
              <path d="M0 0h24v24H0z" fill="none"/>
            </svg>
          
          
        </a>
      </li>

      

    </ul>
  </div>

  <nav>
    <h3 class="reference-title">
      CartoCosmos
    </h3>

    
      <h3>
        Resources
      </h3>
      
        <a href="https://github.com/CartoCosmos/CartoCosmos">GitHub</a>
      
    

    <h3>Classes</h3><ul><li id="AstroDraw-nav"><a href="AstroDraw.html">AstroDraw</a><ul class='methods'><li data-type="method" id="AstroDraw-mapWKTString-nav"><a href="AstroDraw.html#mapWKTString">mapWKTString</a></li><li data-type="method" id="AstroDraw-onAdd-nav"><a href="AstroDraw.html#onAdd">onAdd</a></li><li data-type="method" id="AstroDraw-shapesToWKT-nav"><a href="AstroDraw.html#shapesToWKT">shapesToWKT</a></li></ul></li><li id="AstroMap-nav"><a href="AstroMap.html">AstroMap</a><ul class='methods'><li data-type="method" id="AstroMap-changeProjection-nav"><a href="AstroMap.html#changeProjection">changeProjection</a></li><li data-type="method" id="AstroMap-currentLayer-nav"><a href="AstroMap.html#currentLayer">currentLayer</a></li><li data-type="method" id="AstroMap-hasNorthPolar-nav"><a href="AstroMap.html#hasNorthPolar">hasNorthPolar</a></li><li data-type="method" id="AstroMap-hasSouthPolar-nav"><a href="AstroMap.html#hasSouthPolar">hasSouthPolar</a></li><li data-type="method" id="AstroMap-loadLayerCollection-nav"><a href="AstroMap.html#loadLayerCollection">loadLayerCollection</a></li><li data-type="method" id="AstroMap-projection-nav"><a href="AstroMap.html#projection">projection</a></li><li data-type="method" id="AstroMap-setCurrentLayer-nav"><a href="AstroMap.html#setCurrentLayer">setCurrentLayer</a></li><li data-type="method" id="AstroMap-target-nav"><a href="AstroMap.html#target">target</a></li></ul></li><li id="AstroMath-nav"><a href="AstroMath.html">AstroMath</a><ul class='methods'><li data-type="method" id="AstroMath-domainToPositiveWest-nav"><a href="AstroMath.html#domainToPositiveWest">domainToPositiveWest</a></li><li data-type="method" id="AstroMath-getMajorRadius-nav"><a href="AstroMath.html#getMajorRadius">getMajorRadius</a></li><li data-type="method" id="AstroMath-getMinorRadius-nav"><a href="AstroMath.html#getMinorRadius">getMinorRadius</a></li><li data-type="method" id="AstroMath-latToPlanetOgraphic-nav"><a href="AstroMath.html#latToPlanetOgraphic">latToPlanetOgraphic</a></li><li data-type="method" id="AstroMath-lonTo360-nav"><a href="AstroMath.html#lonTo360">lonTo360</a></li><li data-type="method" id="AstroMath-toDegrees-nav"><a href="AstroMath.html#toDegrees">toDegrees</a></li><li data-type="method" id="AstroMath-toRadians-nav"><a href="AstroMath.html#toRadians">toRadians</a></li><li data-type="method" id="AstroMath-wrapLongitude-nav"><a href="AstroMath.html#wrapLongitude">wrapLongitude</a></li></ul></li><li id="AstroProj-nav"><a href="AstroProj.html">AstroProj</a><ul class='methods'><li data-type="method" id="AstroProj-getRadii-nav"><a href="AstroProj.html#getRadii">getRadii</a></li><li data-type="method" id="AstroProj-getStringAndCode-nav"><a href="AstroProj.html#getStringAndCode">getStringAndCode</a></li></ul></li><li id="LayerCollection-nav"><a href="LayerCollection.html">LayerCollection</a><ul class='methods'><li data-type="method" id="LayerCollection-addTo-nav"><a href="LayerCollection.html#addTo">addTo</a></li><li data-type="method" id="LayerCollection-createBaseLayers-nav"><a href="LayerCollection.html#createBaseLayers">createBaseLayers</a></li><li data-type="method" id="LayerCollection-createOverlays-nav"><a href="LayerCollection.html#createOverlays">createOverlays</a></li><li data-type="method" id="LayerCollection-initialize-nav"><a href="LayerCollection.html#initialize">initialize</a></li><li data-type="method" id="LayerCollection-isEmpty-nav"><a href="LayerCollection.html#isEmpty">isEmpty</a></li><li data-type="method" id="LayerCollection-loadWFS-nav"><a href="LayerCollection.html#loadWFS">loadWFS</a></li><li data-type="method" id="LayerCollection-loadWFS-nav"><a href="LayerCollection.html#loadWFS">loadWFS</a></li><li data-type="method" id="LayerCollection-onEachFeature-nav"><a href="LayerCollection.html#onEachFeature">onEachFeature</a></li><li data-type="method" id="LayerCollection-parseJSON-nav"><a href="LayerCollection.html#parseJSON">parseJSON</a></li><li data-type="method" id="LayerCollection-pointToLayer-nav"><a href="LayerCollection.html#pointToLayer">pointToLayer</a></li></ul></li><li id="MousePosition-nav"><a href="MousePosition.html">MousePosition</a><ul class='methods'><li data-type="method" id="MousePosition-addInitHook-nav"><a href="MousePosition.html#addInitHook">addInitHook</a></li><li data-type="method" id="MousePosition-changeLatType-nav"><a href="MousePosition.html#changeLatType">changeLatType</a></li><li data-type="method" id="MousePosition-changeLonDirection-nav"><a href="MousePosition.html#changeLonDirection">changeLonDirection</a></li><li data-type="method" id="MousePosition-changeLonDomain-nav"><a href="MousePosition.html#changeLonDomain">changeLonDomain</a></li><li data-type="method" id="MousePosition-mergeOptions-nav"><a href="MousePosition.html#mergeOptions">mergeOptions</a></li><li data-type="method" id="MousePosition-mousePosition-nav"><a href="MousePosition.html#mousePosition">mousePosition</a></li><li data-type="method" id="MousePosition-onAdd-nav"><a href="MousePosition.html#onAdd">onAdd</a></li><li data-type="method" id="MousePosition-onMouseMove-nav"><a href="MousePosition.html#onMouseMove">onMouseMove</a></li><li data-type="method" id="MousePosition-onMouseOut-nav"><a href="MousePosition.html#onMouseOut">onMouseOut</a></li><li data-type="method" id="MousePosition-onRemove-nav"><a href="MousePosition.html#onRemove">onRemove</a></li></ul></li><li id="Projection-nav"><a href="Projection.html">Projection</a><ul class='methods'><li data-type="method" id="Projection-loadCylindrical-nav"><a href="Projection.html#loadCylindrical">loadCylindrical</a></li><li data-type="method" id="Projection-loadNorthPolar-nav"><a href="Projection.html#loadNorthPolar">loadNorthPolar</a></li><li data-type="method" id="Projection-loadSouthPolar-nav"><a href="Projection.html#loadSouthPolar">loadSouthPolar</a></li><li data-type="method" id="Projection-onAdd-nav"><a href="Projection.html#onAdd">onAdd</a></li></ul></li></ul>
  </nav>

  <div id="main">
    
      <h1 class="page-title">
        LayerCollection.js
      </h1>
    

    
      

<section>
  <article>
    <pre class="prettyprint source linenums"><code>import { MY_JSON_MAPS } from "./layers";
import $ from "jquery";

/**
 * @class LayerCollection
 * @aka L.Class.LayerCollection
 * @inherits L.Class
 *
 * @classdesc
 * Holds the base layers and overlays of a particular projection
 * for quick and easy use in the AstroMap class.
 */
export default L.LayerCollection = L.Class.extend({

  /**
   * @function LayerCollection.prototype.initialize
   * @description Constructor that creates the layers.
   * @param {String} target Name of the target.
   * @param {String} projName Name of the projection.
   */
  initialize: function(target, projName) {
    this._target = target;
    this._projName = projName;
    this._baseLayers = {};
    this._overlays = {};
    this._defaultLayerIndex = 0;
    this._wfsLayer = null;
    L.LayerCollection.layerControl = null;

    let layers = this.parseJSON();
    this.createBaseLayers(layers["base"]);
    this.createOverlays(layers["overlays"]);
  },

  /**
   * @function LayerCollection.prototype.parseJSON
   * @description Parses the USGS JSON, creates layer objects for a particular target and projection, and stores them in a JS object.
   * @return {Object} - Dictionary containing the layer information in the format: {base: [], overlays: []}
   */
  parseJSON: function() {
    let layers = {
      base: [],
      overlays: [],
      wfs: []
    };

    let targets = MY_JSON_MAPS["targets"];
    for (let i = 0; i &lt; targets.length; i++) {
      let currentTarget = targets[i];

      if (currentTarget["name"].toLowerCase() == this._target.toLowerCase()) {
        let jsonLayers = currentTarget["webmap"];
        for (let j = 0; j &lt; jsonLayers.length; j++) {
          let currentLayer = jsonLayers[j];
          if (
            currentLayer["projection"].toLowerCase() !=
            this._projName.toLowerCase()
          ) {
            continue;
          }
          if (currentLayer["type"] == "WMS") {
            // Base layer check
            if (currentLayer["transparent"] == "false") {
              layers["base"].push(currentLayer);
              if (currentLayer["primary"] == "true") {
                this._defaultLayerIndex = layers["base"].length - 1;
              }
            } else {
              if (currentLayer["displayname"] != "Show Feature Names") {
                layers["overlays"].push(currentLayer);
              }
            }
          } else {
            layers["wfs"].push(currentLayer);
          }
        }
      }
    }
    return layers;
  },

  /**
   * @function LayerCollection.prototype.createBaseLayers
   * @description Creates WMS layers and adds them to the list of base layers.
   * @param  {List} layers - List of base layer information.
   */
  createBaseLayers: function(layers) {
    for (let i = 0; i &lt; layers.length; i++) {
      let layer = layers[i];
      if (layer["projection"] == this._projName) {
        let baseLayer = L.tileLayer.wms(
          String(layer["url"]) + "?map=" + String(layer["map"]),
          {
            layers: String(layer["layer"])
          }
        );
        let name = String(layer["displayname"]);
        this._baseLayers[name] = baseLayer;
      }
    }
  },

  /**
   * @function LayerCollection.prototype.createOverlays
   * @description Creates WMS layers and adds them to the list of overlays.
   * @param  {List} layers - List of overlay information.
   */
  createOverlays: function(layers) {
    for (let i = 0; i &lt; layers.length; i++) {
      let layer = layers[i];
      let overlay = L.tileLayer.wms(
        String(layer["url"]) + "?map=" + String(layer["map"]),
        {
          layers: String(layer["layer"]),
          transparent: true,
          format: "image/png"
        }
      );
      let name = String(layer["displayname"]);
      this._overlays[name] = overlay;
    }

    // Only add feature names to cylindrical
    if (this._projName == "cylindrical") {
      this._wfsLayer = new L.GeoJSON(null, {

          /**
          * @function LayerCollection.prototype.onEachFeature
          * @description Select each feature.
          * @param  {String} layer - Overlay information.
          * @param  {JSON} feature - Feature from json.
          */
        onEachFeature: function(feature, layer) {
          if (feature.properties &amp;&amp; feature.properties.name) {
            layer.bindPopup(feature.properties.name);
          }
        },
          /**
          * @function LayerCollection.prototype.pointToLayer
          * @description Get point to layer.
          * @param  {Constructor} latlng - Latitude and longitude.
          * @param  {JSON} feature - Feature from json.
          */
        pointToLayer: function(feature, latlng) {
          return new L.CircleMarker(latlng, { radius: 3, fillOpacity: 1 });
        }
      });
      this._overlays["Show Feature Names"] = this._wfsLayer;
    }
  },

  /**
  * @function LayerCollection.prototype.addTo
  * @description Removes the current layers, adds the base layers and overlays to the map, and sets the default layer.
  * @param {AstroMap} map - Map to add layers to.
  */
  addTo: function(map) {
    if (map.currentLayer() != null) {
      map.removeLayer(map.currentLayer());
    }

    if (L.LayerCollection.layerControl) {
      L.LayerCollection.layerControl.remove();
    }

    if (!this.isEmpty()) {
      let defaultLayer = Object.keys(this._baseLayers)[this._defaultLayerIndex];
      this._baseLayers[defaultLayer].addTo(map);
      map.setCurrentLayer(this._baseLayers[defaultLayer]);

      L.LayerCollection.layerControl = L.control.layers(
        this._baseLayers,
        this._overlays
      );
      L.LayerCollection.layerControl.addTo(map);
    }

    if (this._projName == "cylindrical") {
      this.loadWFS(map);
    }
  },

  /**
  * @function LayerCollection.prototype.isEmpty
  * @description Checks to see if there are any base layers.
  * @return {Boolean} Returns true if there are no base layers, false otherwise.
  */
  isEmpty: function() {
    return Object.entries(this._baseLayers).length == 0;
  },

  /**
  * @function LayerCollection.prototype.loadWFS
  * @description  Creates the GeoServer query, queries GeoServer for the feature names, and adds the data to the GeoJSON layer.
  * @param  {AstroMap} map - The AstroMap to add the GeoJSON layer to.
  */
  loadWFS: function(map) {
    let geoJsonUrl =
      "https://astrocloud.wr.usgs.gov/dataset/data/nomenclature/" +
      map.target().toUpperCase() +
      "/WFS";

    let defaultParameters = {
      service: "WFS",
      version: "1.1.0",
      request: "GetFeature",
      outputFormat: "application/json",
      srsName: "EPSG:4326"
    };

    let parameters = L.Util.extend(defaultParameters);
    console.log(geoJsonUrl + L.Util.getParamString(parameters));

    let thisContext = this;
    $.ajax({
      url: geoJsonUrl + L.Util.getParamString(parameters),
      dataType: "json",
      timeout: 30000,
      success: function(data) {
        let sortedFeatures = thisContext.sortFeatures(data["features"]);
        data["features"] = sortedFeatures;
        thisContext._wfsLayer.clearLayers();
        thisContext._wfsLayer.addData(data);
      }
    });
  },

  /**
  * @function LayerCollection.prototype.loadWFS
  * @description  Sorts the features by diameter so that smaller features are on top of the larger features on the map. Features with smaller diameters will be put at the end of the list.
  * @param  {List} data - List of features.
  * @return {Integer} Returns -1 if f1 &lt; f2, 1 if f2 > f1, and 0 if f1==f2.
  */
  sortFeatures: function(data) {
    return data.sort(function(a, b) {
      let f1 = parseFloat(a["properties"]["diameter"]);
      let f2 = parseFloat(b["properties"]["diameter"]);
      if (f1 &lt; f2) {
        return 1;
      } else if (f1 > f2) {
        return -1;
      } else {
        return 0;
      }
    });
  }
});
</code></pre>
  </article>
</section>

    


  </div>

  <br class="clear">

  <footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a>
  </footer>

  <script src="scripts/linenumber.js"></script>
  <script src="scripts/pagelocation.js"></script>

  

</body>
</html>
